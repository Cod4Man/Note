# Shell

## 1. 是什么

Shell 是一个命令行解释器，它为用户提供了一个**向Linux 内核发送请求**以便运行程序的界面系统级程序，用户可以用Shell 来启动、挂起、停止甚至是编写一些程序

## 2. Shell 脚本的执行方式

### 2.1 有格式要求

- 脚本需要以# !/bin/bash 开头 

  其中bash为shell类型，是bash shell，也可以用其他的，国内大部分用bash shell

- 脚本需要有可执行权限

### 2.2 脚本的常用执行方式

1. 脚本的绝对路径或相对路径(需要脚本有+x 权限)

   cd /etc  ./nginx.sh  

   /etc/nginx.sh

2. sh+脚本（无需+x权限）

   sh nginx.sh

## 3. 语法

### 3.1 格式

#### 3.1.1 首行 # !/bin/bash

脚本需要以# !/bin/bash 开头 

其中bash为shell类型，是bash shell，也可以用其他的，国内大部分用bash shell

#### 3.1.2 =左右不要空格

#### 3.1.3 变量默认大写

### 3.2 输出

#### 3.2.1 输出到控制台 echo

```shell
#!bin/bash
echo hello world !
```

### 3.3 变量

- **介绍**

1) Linux Shell 中的变量分为，系统变量和用户自定义变量。
2) 系统变量：\$HOME、\$PWD、\$SHELL、\$USER 等等，比如： echo $HOME 等等..
3) 显示当前shell 中所有变量：set

- **变量定义**

  基本语法
  1) 定义变量：变量名=值（注意=两侧没有空格）

  ```shell
  #!bin/bash
  A=666
  echo A=$A
  echo "A=$A"
  ```

  2) 撤销变量：unset 变量
  3) 声明**静态**变量：readonly 变量，注意：**不能unset**

  ```shell
  readonly B=2
  echo "B=$B"
  #unset B 不能
  variable.sh: 第 8 行:unset: B: 无法反设定: 只读 variable
  ```

  4) 函数赋值给变量``/$()

  ```shell
  #!bin/bash
  FF=`date`
  GG=$(date)
  echo FF=$FF
  echo GG=$GG
  # 系统变量
  echo "tomcat_home=$TOMCAT_HOME"
  ```

- 环境变量

  1) export 变量名=变量值 （功能描述：将shell 变量输出为环境变量/全局变量）
  2) source 配置文件 （功能描述：让修改后的配置信息立即生效）
  3) echo $变量名 （功能描述：查询环境变量的值）

### 3.4 注释

- 单行注释： #

- 多行注释  :<<!   ! (注意需要自己一行书写)

  ```shell
  :<<!
  FF=`date`
  GG=$(date)
  echo FF=$FF
  echo GG=$GG
  !
  ```

### 3.5 外部传参

#### 3.5.1 位置参数变量

\$n （功能描述：n 为数字，$0 代表命令本身，$1-$9 代表第一到第九个参数，十以上的参数，十以上的参数需要用
大括号包含，如${10}）
\$* （功能描述：这个变量代表命令行中所有的参数，\$*把所有的参数看成**一个整体**）
\$@（功能描述：这个变量也代表命令行中所有的参数，不过​\$@把每个参数**区分对待**）
\$#（功能描述：这个变量代表命令行中所有参数的个数）

```shell
#!bin/bash
echo "0=${0} 1=$1 10=${10}"
echo "所有的参数：$*"
echo "所有的参数：$@"
echo "参数的个数：$#"



#################
[root@node1 shell_code]# sh variable.sh  1=A 2=B 3=C 10=P
0=variable.sh 1=1=A 10=
所有的参数：1=A 2=B 3=C 10=P
所有的参数：1=A 2=B 3=C 10=P
参数的个数：4

```

#### 3.5.2 预定义变量

就是shell 设计者事先已经定义好的变量，可以直接在shell 脚本中使用

1) $$ （功能描述：当前进程的进程号（PID））
2) $! （功能描述：后台运行的最后一个进程的进程号（PID））
3) $？（功能描述：最后一次执行的命令的返回状态。如果这个变量的值为0，证明上一个命令正确执行；如果这个变
量的值为非0（具体是哪个数，由命令自己来决定），则证明上一个命令执行不正确了。）



### 3.6 运算符

1) “$((运算式))”或“$[运算式]”或者 expr m + n //expression 表达式(+两侧需要空格)
2) 注意expr 运算符间要有空格, 如果希望将 expr 的结果赋给某个变量，使用 ``
3) expr m - n
4) expr \*, /, % 乘，除，取余

### 3.7 条件判断

[ condition ]（注意condition 前后要有空格）
\#非空返回true，可使用$?验证（0 为true，>1 为false）

> **常用判断条件**
> 1) = 字符串比较
> 2) 两个整数的比较
> -lt 小于
> -le 小于等于 little equal
> -eq 等于
> -gt 大于
> -ge 大于等于
> -ne 不等于
> 3) 按照文件权限进行判断
> -r 有读的权限
> -w 有写的权限
> -x 有执行的权限
> 4) 按照文件类型进行判断
> -f 文件存在并且是一个常规的文件
> -e 文件存在
> -d 文件存在并是一个目录



### 3.8. if 

```shell
# 中括号和条件判断式之间必须有空格
if [ 条件判断式 ]
then
代码
elif [条件判断式]
then
代码
fi
```



### 3.9. case

```shell
case $变量名 in
"值1"）
如果变量的值等于值1，则执行程序1
;;
"值2"）
如果变量的值等于值2，则执行程序2
;;
# ...省略其他分支..
*） # 类似default
如果变量的值都不是以上的值，则执行此程序
;;
esac
```

### 3.10 for

```shell
# for in
for 变量 in 值1 值2 值3...
do
程序/代码
done

# for i
for (( 初始值;循环控制条件;变量变化 ))
do
程序/代码
done
```

### 3.11 while循环

```shell
while [ 条件判断式 ]
do
程序 /代码
done
注意：while 和 [有空格，条件判断式和 [也有空格
```

### 3.14 read 读取控制台输入

类似java的scanner

```shell
read(选项)(参数)
选项：
-p：指定读取值时的提示符；
-t：指定读取值时等待的时间（秒），如果没有在指定的时间内输入，就不再等待了。。
参数


#!/bin/bash
#案例1：读取控制台输入一个NUM1 值
read -p "请输入一个数NUM1=" NUM1
echo "你输入的NUM1=$NUM1"
#案例2：读取控制台输入一个NUM2 值，在10 秒内输入。
read -t 10 -p "请输入一个数NUM2=" NUM2
echo "你输入的NUM2=$NUM2"
```

### 3.15 函数

> **自定义函数**

```shell
function getSum() {
    SUM=$[$n1+$n2]
    echo "和是=$SUM"
    }
#输入两个值
read -p "请输入一个数n1=" n1
read -p "请输入一个数n2=" n2
#调用自定义函数
getSum $n1 $n2
```





