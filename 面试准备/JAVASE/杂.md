# æ‚

## 1. åŒ…è£…ç±»

### 1.1 æ¯”è¾ƒå¤§å°æ—¶çš„è‡ªåŠ¨æ‹†ç®±

```java
public static void main(String[] args){
    Integer i1 = new Integer(4);
    Integer i2 = new Integer(6);
    Integer i3 = new Integer(10);
    Integer i4 = new Integer(10);
    System.out.print(i3 == i4);//false, æ¯”è¾ƒçš„æ˜¯åœ°å€
    System.out.print(i3 == i1+i2);//true
    // è§£æ
    // å¯¹è±¡æ— æ³•è¿›è¡Œâ€œ+â€æ“ä½œï¼Œæ‰€ä»¥åŒ…è£…ç±»i1å’Œi2ä¼šå…ˆæ‹†ç®±æˆintï¼Œç„¶åè¿›è¡Œâ€œ+â€æ“ä½œï¼Œåˆ™å³è¾¹ç»“æœä¸º(int)10ï¼Œè€ŒåŒ…è£…ç±»å’ŒåŸºæœ¬æ•°æ®ç±»å‹æ¯”è¾ƒä¹Ÿä¼šå…ˆæ‹†ç®±ï¼Œæ‰€ä»¥å·¦è¾¹ä¸ºï¼ˆintï¼‰10ï¼Œæ‰€ä»¥æ¯”è¾ƒçš„æ˜¯å¤§å°ï¼Œè€Œéåœ°å€å€¼ã€‚
}
```

### 1.2 Integerçš„å¸¸é‡æ± [-128, 127]

```java
public static void main(String[] args)
{

    Integer i1 = new Integer(66);
    Integer i2 = new integer(66);
    Integer i3 = 66; // Integer = intï¼Œä¼šè‡ªåŠ¨è£…ç®±
    Integer i4 = 66;
    Integer i5 = 150;
    Integer i6 = 150;
    System.out.println(i1 == i2);//false
    System.out.println(i3 == i4);//true, å¸¸é‡æ± [-128, 127]åŒºé—´èŒƒå›´ï¼Œå–å¾—æ˜¯å¸¸é‡æ± ï¼Œåœ°å€åŒä¸€ä¸ª
    System.out.println(i5 == i6);//falseï¼Œ è¶…å‡ºå¸¸é‡æ± èŒƒå›´ï¼Œåˆ›å»ºæ–°å¯¹è±¡
}


/*
*ã€€Integeræºç 
*/
public static Integer valueOf(int i) {
    if (i >= IntegerCache.low && i <= IntegerCache.high)
        return IntegerCache.cache[i + (-IntegerCache.low)];
    return new Integer(i);
}
```

### 1.3 åŒ…è£…ç±»ä¹Ÿæ˜¯finalä¿®é¥°çš„

æ„å‘³ç€å’ŒStringç±»ä¼¼ï¼Œæ¯æ¬¡èµ‹å€¼éƒ½ä¼šäº§ç”Ÿæ–°çš„å¯¹è±¡ï¼Œåœ°å€æŒ‡å‘å°±å˜äº†ï¼Œä¸å†æ˜¯åŸæ¥çš„å€¼ã€‚**æ‰€ä»¥åŒ…è£…ç±»æ–¹æ³•ä¼ å‚å¹¶ä¸ä¼šæ”¹å˜åŸæ¥çš„å€¼ã€‚** 

```java
private static void test02() {
    Integer i = 200;
    System.out.println(i.getClass().getName() + "@" + Integer.toHexString(i.hashCode())); 
    // java.lang.Integer@c8
    i += 2;
    System.out.println(i.getClass().getName() + "@" + Integer.toHexString(i.hashCode())); 
    // java.lang.Integer@ca

}
```

```java
private static void test02(integer i) {
    i+=1;
}
main () {
    Integer a = 2;
    test02(a);
    sout(a); // ä»ç„¶æ˜¯2
}
```



## 2. String

### 2.1 Stringå¸¸é‡æ± 

- Stringç”±finalä¿®é¥°ï¼Œä¸å¯è¢«ç»§æ‰¿ã€‚
- Stringåˆ›å»ºå¯¹è±¡çš„ä¸¤ç§æ–¹å¼

```java
//1ã€
String str = new String("abcd"); 
// ä½¿ç”¨ new åˆ›å»ºçš„å¯¹è±¡ï¼Œå­˜æ”¾åœ¨å †ä¸­ã€‚æ¯æ¬¡è°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚
 
//2ã€
String str = "abcd";
// å…ˆåœ¨æ ˆä¸Šåˆ›å»ºä¸€ä¸ª String ç±»çš„å¯¹è±¡å¼•ç”¨å˜é‡ strï¼Œç„¶åé€šè¿‡ç¬¦å·å¼•ç”¨å»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ‰¾æœ‰æ²¡æœ‰ â€œabcdâ€ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™å°†â€œabcdâ€å­˜æ”¾åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå¹¶å°†æ ˆä¸Šçš„ str å˜é‡å¼•ç”¨æŒ‡å‘å¸¸é‡æ± ä¸­çš„â€œabcdâ€ã€‚å¦‚æœå¸¸é‡æ± ä¸­å·²ç»æœ‰â€œabcdâ€äº†ï¼Œåˆ™ä¸ä¼šå†å¸¸é‡æ± ä¸­åˆ›å»ºâ€œabcdâ€ï¼Œè€Œæ˜¯ç›´æ¥å°† str å¼•ç”¨æŒ‡å‘å¸¸é‡æ± ä¸­çš„â€œabcdâ€ã€‚
```

### 2.2 å…³äºå­—ç¬¦ä¸² + å·è¿æ¥é—®é¢˜(å®è´¨æ˜¯StringBuilder.append) 

å¯¹äºå­—ç¬¦ä¸²å¸¸é‡çš„ + å·è¿æ¥ï¼Œåœ¨ç¨‹åºç¼–è¯‘æœŸï¼ŒJVMå°±ä¼š**å°†å…¶ä¼˜åŒ–ä¸º + å·è¿æ¥åçš„å€¼**ã€‚æ‰€ä»¥åœ¨**ç¼–è¯‘æœŸå…¶å­—ç¬¦ä¸²å¸¸é‡çš„å€¼å°±ç¡®å®šäº†**ã€‚ 

```java
    String a = "a1";   
    String b = "a" + 1;   // ç¼–è¯‘å=ã€‹String b = â€œa1â€
    System.out.println((a == b)); //result = true  
     
    String a = "a3.4";   
    String b = "a" + 3.4;  // ç¼–è¯‘å=ã€‹String b = â€œa3.4â€ 
    System.out.println((a == b)); //result = true 

	String a = "a";
	String b = "ab";
	String c = a + "b"; // åç¼–è¯‘åå‘ç°ï¼Œ String c = (new StringBuilder()).append(a).append("b").toString(); è¯´æ˜cå¯¹è±¡æ˜¯newå‡ºæ¥çš„ï¼Œè€Œä¸æ˜¯å»å¸¸é‡æ± åˆ›å»º
// public synchronized String toString() {
   //  if (toStringCache == null) {
      //   toStringCache = Arrays.copyOfRange(value, 0, count);
   //  }
	// å¯ä»¥çœ‹åˆ°SB.toString()è¿”å›çš„æ˜¯new String()
   //  return new String(toStringCache, true);
// }

	System.out.println((b == c)); //result = false 
	// cåœ¨ç¼–è¯‘æœŸé—´æ— æ³•ç¡®è®¤aå¯¹è±¡çš„å€¼(æ˜¯å¦ä¼šå˜åŒ–)ï¼Œå› æ­¤ç¼–è¯‘æœŸé—´æ— æ³•ç¡®è®¤cçš„å€¼ã€‚
	// ä¼šåœ¨è¿è¡ŒæœŸé—´ï¼ŒåŠ¨æ€çš„åˆ†é…å¹¶å°†è¿æ¥åçš„æ–°åœ°å€å¤åˆ¶ç»™cã€‚
```

å› æ­¤ï¼Œå°½é‡ä¸è¦åœ¨forä¸­ä½¿ç”¨â€œ+â€ç¬¦å·æ“ä½œå­—ç¬¦ä¸²ï¼Œè€Œæ˜¯**ä½¿ç”¨StringBuffer/StringBuilderå»æ›¿æ¢**ã€‚

ä¸Šé¢demoä¸­ï¼Œ`String c = a + "b"` , cåœ¨ç¼–è¯‘æœŸé—´æ— æ³•å¾—çŸ¥açš„å€¼ï¼Œaå¯ä»¥ç”¨**finalä¿®é¥°**ï¼ˆè¿™æ ·aå°±æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œç¼–è¯‘æœŸé—´å°±èƒ½è·å¾—å®ƒçš„å€¼ï¼Œå°±åƒdä¸€æ ·ï¼‰ã€‚

### 2.3 intern()

è°ƒç”¨Â intern æ–¹æ³•ã€‚

ä»JDK7å¼€å§‹ï¼Œ**å¦‚æœåœ¨å¸¸é‡æ± æ‰¾ä¸åˆ°å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œåˆ™ä¸ä¼šå†å°†å­—ç¬¦ä¸²æ‹·è´åˆ°å¸¸é‡æ± ï¼Œè€Œåªæ˜¯åœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆä¸€ä¸ªå¯¹åŸå­—ç¬¦ä¸²çš„å¼•ç”¨ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯å¾€å¸¸é‡æ± æ”¾çš„ä¸œè¥¿å˜äº†ï¼šåŸæ¥åœ¨å¸¸é‡æ± ä¸­æ‰¾ä¸åˆ°æ—¶ï¼Œå¤åˆ¶ä¸€ä¸ªå‰¯æœ¬æ”¾åˆ°å¸¸é‡æ± ï¼Œ1.7ååˆ™æ˜¯å°†åœ¨<u>å †ä¸Šçš„åœ°å€å¼•ç”¨å¤åˆ¶åˆ°å¸¸é‡æ± </u>ã€‚**(internä¸å†æ‹·è´å­—ç¬¦ä¸²åˆ°å¸¸é‡æ± ï¼Œè€Œæ˜¯åªæœ‰å †çš„åœ°å€å¼•ç”¨ef0010, ç›¸æ¯”ä¹‹å‰ï¼Œå¯ä»¥èŠ‚çœç©ºé—´,å¸¸é‡æŒ‡é’ˆæŒ‡å‘å †) 

![1615098869302](img\Stringçš„internæ–¹æ³•.png)

```java
public static void main(String[] args){
    String str0 = "57tongcheng";
    String str1 = new String("58tongcheng2");
    String str2 = new StringBuilder("58").append("tongcheng").toString();
    String str3 = new StringBuilder("ja").append("va").toString();
    String str4 = new StringBuilder("57").append("tongcheng").toString();
    System.out.println(str0 == str0.intern()); // true, str0 = "57tongcheng"æ˜¯åˆ›å»ºåœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œstr0.internæŒ‡å‘çš„æ˜¯"57tongcheng"é¦–æ¬¡å¼•ç”¨çš„åœ°å€ï¼Œè€Œå°±æ˜¯str0çš„åœ°å€ï¼Œå³å¸¸é‡æ± åœ°å€
    System.out.println(str1 == str1.intern()); // falseï¼Œ new Stringæ˜¯åˆ›å»ºå¯¹è±¡(å¹¶ä¸”åŒæ—¶åœ¨å¸¸é‡æ± åŠ å…¥è¯¥å­—ç¬¦ä¸²)ï¼Œinternè¿”å›çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„åœ°å€ï¼Œnewçš„æ˜¯å¦å¤–ä¸€ä¸ªåœ°å€ã€‚ï¼ˆnewåˆ›å»º2ä¸ªåœ°å€ï¼šnew+å¸¸é‡æ± ï¼‰
    System.out.println(str2 == str2.intern()); // trueï¼Œ "58tongcheng"å†å¸¸é‡æ± æ²¡æœ‰ï¼Œæ‰€ä»¥internæŒ‡å‘str2çš„å¯¹è±¡åœ°å€
    System.out.println(str3 == str3.intern()); // false, "java"å­—ç¬¦ä¸²åœ¨å¸¸é‡æ± å·²æœ‰()ï¼ŒinternæŒ‡å‘ç¬¬ä¸€æ¬¡çš„å¯¹è±¡å¼•ç”¨åœ°å€
    System.out.println(str4 == str4.intern()); // falseï¼Œ"57tongcheng"str0å·²ç»åŠ å…¥åˆ°å¸¸é‡æ± ï¼Œæ‰€ä»¥str4.internæŒ‡å‘çš„æ˜¯str0çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯å¸¸é‡æ± åœ°å€
}
```

- "java"å¸¸é‡æ± çš„ç”±æ¥

```java
public final class System {

    /* register the natives via the static initializer.
     *
     * VM will invoke the initializeSystemClass method to complete
     * the initialization for this class separated from clinit.
     * Note that to use properties set by the VM, see the constraints
     * described in the initializeSystemClass method.
     */
    private static native void registerNatives();
    static {
        registerNatives();
    }
    
    
    private static void initializeSystemClass() {

        // VM might invoke JNU_NewStringPlatform() to set those encoding
        // sensitive properties (user.home, user.name, boot.class.path, etc.)
        // during "props" initialization, in which it may need access, via
        // System.getProperty(), to the related system encoding property that
        // have been initialized (put into "props") at early stage of the
        // initialization. So make sure the "props" is available at the
        // very beginning of the initialization and all system properties to
        // be put into it directly.
        props = new Properties();
        initProperties(props);  // initialized by the VM

        // There are certain system configurations that may be controlled by
        // VM options such as the maximum amount of direct memory and
        // Integer cache size used to support the object identity semantics
        // of autoboxing.  Typically, the library will obtain these values
        // from the properties set by the VM.  If the properties are for
        // internal implementation use only, these properties should be
        // removed from the system properties.
        //
        // See java.lang.Integer.IntegerCache and the
        // sun.misc.VM.saveAndRemoveProperties method for example.
        //
        // Save a private copy of the system properties object that
        // can only be accessed by the internal implementation.  Remove
        // certain system properties that are not intended for public access.
        sun.misc.VM.saveAndRemoveProperties(props);


        lineSeparator = props.getProperty("line.separator");
        sun.misc.Version.init(); // è¿™é‡Œ
    }
}
    
public class Version {
    private static final String launcher_name = "java"; // è¿™é‡Œï¼Œâ€œjavaâ€.internæŒ‡å‘çš„æ˜¯launcher_name
    private static final String java_version = "1.8.0_112";
    private static final String java_runtime_name = "Java(TM) SE Runtime Environment";
    private static final String java_profile_name = "";
    private static final String java_runtime_version = "1.8.0_112-b15";
    private static boolean versionsInitialized;
}
    
    
    
    
```

## 3. ++/-- æ“ä½œæ•°æ ˆå’Œå¸¸é‡æ± 

**æ€»ç»“ï¼šç®—æ•°è¿ç®—æ˜¯åœ¨æ“ä½œæ•°æ ˆé‡Œé¢è¿ç®—ï¼Œè€Œ++åŠ¨ä½œç›´æ¥æ”¹å˜å¸¸é‡çš„å€¼ï¼Œå³è‡ªå¢è‡ªå‡ä¸ç»è¿‡æ“ä½œæ•°æ ˆ**

```java
main() {
    int i = 1;    //   1.å±€éƒ¨å˜é‡ i=â€˜â€™   ï¼Œ2.æ“ä½œæ•°æ ˆ: 1    ,  3.èµ‹å€¼åŠ¨ä½œ i=1
    i = i++;      //   1.å±€éƒ¨å˜é‡ i=1    ï¼Œ2.æ“ä½œæ•°æ ˆ: 1(å› ä¸ºæ˜¯å++)  , 3.i++åŠ¨ä½œç›´æ¥ä¿®æ”¹å±€éƒ¨å˜é‡,æ­¤æ—¶å±€éƒ¨å˜é‡è‡ªå¢ï¼šå±€éƒ¨å˜é‡i=2,æ“ä½œæ•°æ ˆï¼š1   4.èµ‹å€¼åŠ¨ä½œï¼ši(2)=1; 2è¢«1è¦†ç›–
    int j = i++;  // 1. å’Œç¬¬äºŒè¡Œä¸€æ ·ï¼Œåªæ˜¯i++åï¼Œæ²¡æœ‰å†æ¬¡èµ‹å€¼è¦†ç›–iï¼Œæ‰§è¡Œå®Œåi=2ï¼›j=1
    int k = i + ++i * i++;  // 1. å±€éƒ¨ï¼ši=2;æ“ä½œæ ˆï¼š2->(++iåŠ¨ä½œ)
    					  // 2. ++iåŠ¨ä½œï¼šå±€éƒ¨ï¼ši=3ï¼›æ“ä½œæ ˆï¼š2->3(++iä¼šé‡æ–°æ‹¿å±€éƒ¨å€¼)->(i++åŠ¨ä½œ)
    					  // 3. i++åŠ¨ä½œï¼šå…ˆæ“ä½œæ ˆï¼š2->3->3ï¼›å±€éƒ¨ï¼ši=4
    					  // 4. æ“ä½œæ ˆè®¡ç®—ï¼š11ï¼›èµ‹å€¼k=11

    System.out.println(i); // 4
    System.out.println(j); // 1
    System.out.println(k); // 11
}
```

![1621933737430](img\++ æ“ä½œæ•°æ ˆå’Œå¸¸é‡æ± .png)

## 4. ç±»çš„åˆå§‹åŒ–/å®ä¾‹çš„åˆå§‹åŒ–è¿‡ç¨‹

 å¯¹è±¡å®ä¾‹åŒ–è¿‡ç¨‹(åŒçº§åˆ™é¡ºåºæ‰§è¡Œ)

1. çˆ¶ç±»é™æ€å¯¹è±¡(é¦–æ¬¡åŠ è½½)\<clinit>

2. å­ç±»é™æ€å¯¹è±¡(é¦–æ¬¡åŠ è½½)\<clinit>

3. çˆ¶ç±»éé™æ€å¯¹è±¡(æ³¨æ„æ˜¯å¦æœ‰å­ç±»é‡å†™ï¼Œé‡å†™åˆ™ç›´æ¥è°ƒç”¨å­ç±»)ï¼ˆ3ä¼˜å…ˆäº4æ‰§è¡Œï¼Œæ˜¯å› ä¸ºæ„é€ æ–¹æ³•ä¼šéšå¼è°ƒç”¨super()ï¼‰\<init>

    3.5 çˆ¶ç±»æ„é€ æ–¹æ³•

4. å­ç±»éé™æ€å¯¹è±¡\<init>

â€‹        4.5å­ç±»æ„é€ æ–¹æ³•

- ç±»çš„åˆå§‹åŒ–
  - å­ç±»åˆå§‹åŒ–éœ€è¦å…ˆåˆå§‹åŒ–çˆ¶ç±»
  - ä¸€ä¸ªç±»çš„åˆå§‹åŒ–å°±æ˜¯æ‰§è¡Œ\<clinit>æ–¹æ³•
    - å…¶ä¸­\<clinit>æ–¹æ³•ç”±é™æ€å˜é‡+é™æ€ä»£ç å—ç»„æˆ
    - æ‰§è¡Œé¡ºåºä»ä¸Šå¾€ä¸‹
  - \<clinit>åªæ‰§è¡Œä¸€æ¬¡
- å®ä¾‹åˆå§‹åŒ–
  - åˆå§‹åŒ–å°±æ˜¯è°ƒç”¨\<init>æ–¹æ³•
  - \<init>æ–¹æ³•å¯èƒ½é‡è½½æœ‰å¤šä¸ªï¼Œæœ‰å‡ ä¸ªé‡è½½æ–¹æ³•å°±æœ‰å‡ ä¸ª\<init>
  - \<init>æ–¹æ³•ç”±éé™æ€å˜é‡+éé™æ€ä»£ç å—+æ„é€ æ–¹æ³•ç»„æˆ
  - æ‰§è¡Œé¡ºåºä»ä¸Šå¾€ä¸‹ï¼Œä½†æ˜¯æ„é€ æ–¹æ³•æœ€åæ‰§è¡Œã€‚
  - \<init>æ–¹æ³•çš„é¦–è¡Œæ˜¯super([arg])(æ€»æ˜¯æœ‰ï¼Œä¸å†™å°±æ˜¯é»˜è®¤æœ‰)ï¼Œå³çˆ¶ç±»çš„\<init>æ–¹æ³•

```java
// å¯¹è±¡å®ä¾‹åŒ–è¿‡ç¨‹(åŒçº§åˆ™é¡ºåºæ‰§è¡Œ)
// 1. çˆ¶ç±»é™æ€å¯¹è±¡(é¦–æ¬¡åŠ è½½)<clinit>
// 2. å­ç±»é™æ€å¯¹è±¡(é¦–æ¬¡åŠ è½½)<clinit>
// 3. çˆ¶ç±»éé™æ€å¯¹è±¡(æ³¨æ„æ˜¯å¦æœ‰å­ç±»é‡å†™ï¼Œé‡å†™åˆ™ç›´æ¥è°ƒç”¨å­ç±»)ï¼ˆ3ä¼˜å…ˆäº4æ‰§è¡Œï¼Œæ˜¯å› ä¸ºæ„é€ æ–¹æ³•ä¼šéšå¼è°ƒç”¨super()ï¼‰<init>
// 3.5 çˆ¶ç±»æ„é€ æ–¹æ³•
// 4. å­ç±»éé™æ€å¯¹è±¡<init>
// 4.5. å­ç±»æ„é€ æ–¹æ³•
public class ClassInstanceOrder {
    public static void main(String[] args) {
        Son son1 = new Son(); // 1234567589
        System.out.println();
        Son son2 = new Son(); // 567589
    }
}

class Farther {
    private int i = test();
    private static int j = method();


    public Farther () {
        System.out.print(7);
    }

    static {
        System.out.print(2);
    }

    {
        System.out.print(6);
    }

    public int test() {
        System.out.print("---æ‰§è¡Œä¸åˆ°---");
        return 0;
    }

    public static int method() {
        System.out.print(1);
        return 0;
    }

}

class Son extends Farther {
    private int i = test();
    private static int j = method();



    public Son () {
        System.out.print(9);
    }

    static {
        System.out.print(4);
    }

    {
        System.out.print(8);
    }

    public int test() {
        System.out.print(5);
        return 0;
    }

    public static int method() {
        System.out.print(3);
        return 0;
    }
}
```

## 5. æ–¹æ³•çš„é‡å†™å’Œé‡è½½

### 5.1 æ–¹æ³•é‡å†™

- ä¸å¯é‡å†™
  - çˆ¶ç±»finalä¿®é¥°
  - çˆ¶ç±»staticä¿®é¥°
  - çˆ¶ç±»privateä¿®é¥°
- æ€§è´¨ï¼š
  - ç›¸åŒæ–¹æ³•å
  - è®¿é—®ä¿®é¥°ç¬¦ä¸ä¸¥äºçˆ¶ç±»
  - ä¸æŠ›å‡ºæ¯”çˆ¶ç±»èŒƒå›´å¤§çš„å¼‚å¸¸
  - è¿”å›å€¼æ˜¯çˆ¶ç±»çš„æˆ–extends

### 5.2 æ–¹æ³•é‡è½½

- æ€§è´¨ï¼š
  - ç›¸åŒæ–¹æ³•å
  - å½¢å‚ä¸ªæ•°æˆ–é¡ºåºä¸åŒ
  - ä¸ä¿®é¥°ç¬¦/è¿”å›å€¼æ— å…³

## 6. å±€éƒ¨å˜é‡å’Œæˆå‘˜å˜é‡

- å±€éƒ¨å˜é‡å­˜åœ¨çš„ä½ç½®
  - æ–¹æ³•å—å†…éƒ¨
  - **ä»£ç å—å†…éƒ¨**

  ```java
  int i = 0;
  {
      int i = 9;
      i++;
      this.i++;
  }
  ```

- æˆå‘˜å˜é‡ï¼š

  - é™æ€å˜é‡
  - éé™æ€å˜é‡

- å€¼å¾—å­˜å‚¨ä½ç½®ï¼š

  - å±€éƒ¨å˜é‡ï¼š**æ ˆ**
  - éé™æ€æˆå‘˜å˜é‡ï¼šå †
  - é™æ€æˆå‘˜å˜é‡ï¼š**æ–¹æ³•åŒº**

## 7. Objectæ–¹æ³• 

### 7.1 finalize : GCå¯¹è±¡å‰ä¼šè°ƒç”¨è¯¥æ–¹æ³•

å¦‚æœå¯¹è±¡æœ‰é‡å†™è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆGCå‰ä¼šæ‰§è¡Œï¼Œå¯ä»¥å¤æ´»å¯¹è±¡ã€‚

```java
public class FinalizeDemo {

    static Finalizeee finalizeee = null;
    public static void main(String[] args) throws InterruptedException {
        finalizeee = new Finalizeee();
        finalizeee = null;
        System.out.println("gc before");
        System.gc();
        Thread.sleep(500);
        System.out.println("gc after");
        System.out.println(finalizeee);
    }
}

class Finalizeee {
    @Override
    protected void finalize() throws Throwable {
        super.finalize();
        FinalizeDemo.finalizeee = this;
        System.out.println("å¤æ´»å•¦");
    }
}
```

## 8. cglibå’ŒjdkåŠ¨æ€ä»£ç†åŒºåˆ« 

- **cglibå’ŒjdkåŠ¨æ€ä»£ç†åŒºåˆ«ï¼š**

1ã€JDKä¸­çš„åŠ¨æ€ä»£ç†æ˜¯é€šè¿‡åå°„ç±»Proxyä»¥åŠInvocationHandlerå›è°ƒæ¥å£å®ç°çš„ï¼Œ**ä½†æ˜¯JDKä¸­æ‰€æœ‰è¦è¿›è¡ŒåŠ¨æ€ä»£ç†çš„ç±»å¿…é¡»è¦å®ç°ä¸€ä¸ªæ¥å£**ï¼Œä¹Ÿå°±æ˜¯è¯´**åªèƒ½å¯¹è¯¥ç±»æ‰€å®ç°æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•(è¯¥ç±»å¯ä»¥æœ‰è‡ªå·±çš„å­ç±»æ–¹æ³•å°±ä»£ç†ä¸äº†äº†)**è¿›è¡Œä»£ç†ï¼Œè¿™åœ¨å®é™…ç¼–ç¨‹ä¸­æœ‰ä¸€å®šçš„**å±€é™æ€§**ï¼Œè€Œä¸”ä½¿ç”¨**åå°„çš„æ•ˆç‡ä¹Ÿä¸é«˜** 

2ã€ CglibåŠ¨æ€ä»£ç†ï¼šä½¿ç”¨cglibæ˜¯å®ç°åŠ¨æ€ä»£ç†ï¼Œ**ä¸å—ä»£ç†ç±»å¿…é¡»å®ç°æ¥å£çš„é™åˆ¶**ï¼Œå› ä¸ºcglibåº•å±‚æ˜¯ç”¨**ASMæ¡†æ¶**ï¼Œä½¿ç”¨**å­—èŠ‚ç æŠ€æœ¯ç”Ÿæˆä»£ç†ç±»**ï¼Œæ¯”ä½¿ç”¨Javaåå°„çš„æ•ˆç‡è¦é«˜ï¼Œ<u>cglibä¸èƒ½å¯¹å£°æ˜finalçš„æ–¹æ³•è¿›è¡Œä»£ç†ï¼Œå› ä¸ºcglibåŸç†æ˜¯åŠ¨æ€ç”Ÿæˆè¢«ä»£ç†ç±»çš„å­ç±»</u> 

- **ä»€ä¹ˆæ—¶å€™ç”¨cglibä»€ä¹ˆæ—¶å€™ç”¨jdkåŠ¨æ€ä»£ç†ï¼Ÿ**

1ã€ç›®æ ‡å¯¹è±¡ç”Ÿæˆäº†æ¥å£ é»˜è®¤ç”¨JDKåŠ¨æ€ä»£ç†

2ã€å¦‚æœç›®æ ‡å¯¹è±¡ä½¿ç”¨äº†æ¥å£ï¼Œå¯ä»¥å¼ºåˆ¶ä½¿ç”¨cglib

3ã€**å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°æ¥å£ï¼Œå¿…é¡»é‡‡ç”¨cglib**åº“ï¼ŒSpringä¼šè‡ªåŠ¨åœ¨JDKåŠ¨æ€ä»£ç†å’Œcglibä¹‹é—´è½¬æ¢

- **JDKåŠ¨æ€ä»£ç†å’Œcglibå­—èŠ‚ç ç”Ÿæˆçš„åŒºåˆ«ï¼Ÿ**

1ã€JDKåŠ¨æ€ä»£ç†åªèƒ½å¯¹å®ç°äº†æ¥å£çš„ç±»ç”Ÿæˆä»£ç†ï¼Œè€Œä¸èƒ½é’ˆå¯¹ç±»

2ã€Cglibæ˜¯é’ˆå¯¹ç±»å®ç°ä»£ç†ï¼Œä¸»è¦æ˜¯å¯¹æŒ‡å®šçš„ç±»ç”Ÿæˆä¸€ä¸ªå­ç±»ï¼Œè¦†ç›–å…¶ä¸­çš„æ–¹æ³•ï¼Œå¹¶è¦†ç›–å…¶ä¸­æ–¹æ³•çš„å¢å¼ºï¼Œä½†æ˜¯å› ä¸ºé‡‡ç”¨çš„æ˜¯ç»§æ‰¿ï¼Œæ‰€ä»¥è¯¥ç±»æˆ–æ–¹æ³•æœ€å¥½ä¸è¦ç”Ÿæˆfinalï¼Œå¯¹äºfinalç±»æˆ–æ–¹æ³•ï¼Œæ˜¯æ— æ³•ç»§æ‰¿çš„

- **Cglibæ¯”JDKå¿«ï¼Ÿ**

1ã€cglibåº•å±‚æ˜¯ASMå­—èŠ‚ç ç”Ÿæˆæ¡†æ¶ï¼Œä½†æ˜¯å­—èŠ‚ç æŠ€æœ¯ç”Ÿæˆä»£ç†ç±»ï¼Œåœ¨JDL1.6ä¹‹å‰æ¯”ä½¿ç”¨javaåå°„çš„æ•ˆç‡è¦é«˜

2ã€åœ¨jdk6ä¹‹åé€æ­¥å¯¹JDKåŠ¨æ€ä»£ç†è¿›è¡Œäº†ä¼˜åŒ–ï¼Œåœ¨è°ƒç”¨æ¬¡æ•°æ¯”è¾ƒå°‘æ—¶æ•ˆç‡é«˜äºcglibä»£ç†æ•ˆç‡

3ã€åªæœ‰åœ¨å¤§é‡è°ƒç”¨çš„æ—¶å€™cglibçš„æ•ˆç‡é«˜ï¼Œä½†æ˜¯åœ¨1.8çš„æ—¶å€™JDKçš„æ•ˆç‡å·²é«˜äºcglib

4ã€Cglibä¸èƒ½å¯¹å£°æ˜finalçš„æ–¹æ³•è¿›è¡Œä»£ç†ï¼Œå› ä¸ºcglibæ˜¯åŠ¨æ€ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œfinalå…³é”®å­—ä¿®é¥°çš„ç±»ä¸å¯å˜åªèƒ½è¢«å¼•ç”¨ä¸èƒ½è¢«ä¿®æ”¹

## 9. å„ç§API

### 9.1 Map

#### 9.1.1 putIfAbsent  /  computeIfAbsent   /  computeIfPresent 

```java
{
        Map<Integer, Integer> map = new HashMap<>();
        map.putIfAbsent(1, 2);  // 2
        map.putIfAbsent(1, 3);  // 2 ä¸å­˜åœ¨æ—¶æ‰æ’å…¥
        map.computeIfAbsent(2, k -> 2);  // 2
        map.computeIfAbsent(2, k -> ++k); // 2 ä¸å­˜åœ¨æ—¶æ’å…¥ï¼Œæ’å…¥è§„åˆ™è‡ªå®š
        map.put(3, 1);
        map.computeIfPresent(3, (k, oV) -> ++oV); // 2
        map.computeIfPresent(3, (k, oV) -> ++oV); // 3 å­˜åœ¨æ—¶æ’å…¥ï¼Œæ’å…¥è§„åˆ™è‡ªå®š
}
```

### 9.2 Stream + Lambda

Lambda è¡¨è¾¾å¼æ˜¯ Java 1.8 è·Ÿ Stream æœºåˆ¶ä¸€åŒæ¨å‡ºçš„ã€‚Lambda è¡¨è¾¾å¼æå¤§åœ°å‡å°‘äº†ä»£ç é‡ï¼Œå¢åŠ äº†ä»£ç çš„å¯è¯»æ€§ã€‚  å¼•å…¥ Lambda è¡¨è¾¾å¼ä¹‹åï¼ŒJava å¼€å§‹æ”¯æŒ**æŠŠå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’**ã€‚ 

- å‡½æ•°å¼æ¥å£ï¼šæ¥å£åª**æœ‰å”¯ä¸€çš„æœªå®ç°**çš„æ–¹æ³•(å¯ä»¥ç”¨defalut/Objectæ–¹æ³•[æ‰€æœ‰ç±»çš„åŸºç±»])

  å¯ä»¥ç”¨@FunctionalInterfaceæ³¨è§£å£°æ˜ï¼Œè¿™æ ·ä¼šç¼–è¯‘æ—¶æŠ¥é”™

- åŒå†’å·ï¼š â€œ :: â€

  - é™æ€å¼•ç”¨ï¼š.filter(Objects::nonNull) // éç©ºè¿‡æ»¤ /  .map(Map.Entry::getKey)
  - æ™®é€šæ–¹æ³•å¼•ç”¨ï¼š .filter(new Java8Stream()::start2) è¯­å¢ƒè¦å¯¹ã€‚æ¯”å¦‚è¯¥filterçš„å¯¹è±¡å¿…é¡»æœªstart2çš„å½¢å‚

- åˆ›å»ºStreamçš„ä¸‰ç§å½¢å¼

  - Streamé™æ€æ–¹æ³•ï¼š

    Stream.of("1", "2", "3")

  - Arrays.stream(Array)

  - list.stream()

  - ç‰¹æ®Šæµ

    è¿˜æœ‰ä¸¤ç§æ¯”è¾ƒç‰¹æ®Šçš„æµ

    - ç©ºæµï¼š**Stream**.**empty()**
    - æ— é™æµï¼š**Stream**.**generate()** å’Œ **Stream**.**iterate()**ã€‚å¯ä»¥é…åˆ **limit()** ä½¿ç”¨å¯ä»¥é™åˆ¶ä¸€ä¸‹æ•°é‡

    ```java
    // æ¥å—ä¸€ä¸ª Supplier ä½œä¸ºå‚æ•°
    Stream.generate(Math::random).limit(10).forEach(System.out::println);
    // åˆå§‹å€¼æ˜¯ 0ï¼Œæ–°å€¼æ˜¯å‰ä¸€ä¸ªå…ƒç´ å€¼ + 2
    Stream.iterate(0, n -> n + 2).limit(10).forEach(System.out::println);
    ```

>  **æµå¤„ç†çš„ç‰¹æ€§**

1. **ä¸å­˜å‚¨æ•°æ®**
2. ä¸ä¼šæ”¹å˜æ•°æ®æº
3. **ä¸å¯ä»¥é‡å¤ä½¿ç”¨**: æ¯æ¬¡é“¾å¼è°ƒç”¨éƒ½æ˜¯äº§ç”Ÿæ–°çš„streamï¼Œæ—§çš„streamè¢«é”€æ¯

- API 

```java
private static Integer[] getTop5(int[] arr) {
    Integer[] objects = Arrays.stream(arr)
        .boxed()  // è£…ç®±
        .parallel() // å¹¶è¡Œ
        .filter(Objects::nonNull) // éç©ºè¿‡æ»¤
        .filter() // é‡å¤è¿‡æ»¤
        .collect(Collectors.groupingBy(Integer::intValue, Collectors.counting())) // èšé›†
        // Collectorså¯åšåˆ†ç»„/æ±‚å’Œ/å¹³å‡/è½¬Map/è½¬List/è½¬Setç­‰æ“ä½œ
        .entrySet() // Map.Entryæ‰å¯è½¬æ¢æˆstream
        .stream()
        .sorted((o1, o2) -> (int) (o2.getValue() - o1.getValue())) // æ’åº
        .map(Map.Entry::getKey) // è½¬æ¢
        .toArray(Integer[]::new); // èšé›†
    // [2=7, 1=6, 4=2, 5=2, 6=1, 7=1, 8=1]
    return Arrays.copyOfRange(objects, 0, 5, Integer[].class);
}


public static void main(String[] args) {
        List<FeeBillDetail> feeBillDetailList = new ArrayList<>();
        feeBillDetailList.add(new FeeBillDetail().setType(1).setFee(new BigDecimal("23")));
        feeBillDetailList.add(new FeeBillDetail().setType(2).setFee(new BigDecimal("66")));
        feeBillDetailList.add(new FeeBillDetail().setType(2).setFee(new BigDecimal("34")));
        Map<Integer, BigDecimal> collect = feeBillDetailList.stream()
                .collect(Collectors.groupingBy(FeeBillDetail::getType, Collectors.toList()))
                .entrySet()
                .stream()
                .map((entry) -> {
                    HashMap<Integer, BigDecimal> resultMap = new HashMap<>();
                    resultMap.put(entry.getKey(), entry.getValue().stream().map(FeeBillDetail::getFee).reduce(BigDecimal.ZERO, BigDecimal::add));
                    return resultMap;
                })
                .flatMap(re -> re.entrySet().stream())
                .collect(Collectors.toMap(
                        Map.Entry::getKey,
                        Map.Entry::getValue));
        System.out.println(collect);
    }
    
    
    
// flatMapæµçš„æ‰å¹³åŒ–å¤„ç†ï¼šè®²é›†åˆæ‰å¹³åŒ–
public static void main(String[] args) {
	// Map<String, List<String>> map = new HashMap<>();
	List<List<String>> list = new ArrayList<>();
	List<String> ll = new ArrayList<>();
	ll.add("2222");
	ll.add("3333");
	list.add(ll);
	List<String> ll2 = new ArrayList<>();
	ll2.add("aaaa");
	ll2.add("bbbb");
	list.add(ll2);
	System.out.println(list); // [[2222, 3333], [aaaa, bbbb]]
	List<String> collect = list.stream()
		.flatMap(List::stream) // .flatMap(zz -> zz.stream())
		.collect(Collectors.toList());
	System.out.println(collect); // [2222, 3333, aaaa, bbbb]
}

// Map<Object,List<Object>> æ‰å¹³åŒ–value

void m(){
	Map<Long, List<DatasourceVO>> datasourceVOMap = null;
	Map<Long, DatasourceVO> collect = datasourceVOMap.get(moduleId)
                                    .stream()
                                    .collect(Collectors.groupingBy(DatasourceVO::getId, Collectors.toList())) // Map<Long, List<DatasourceVO>>
                                    .entrySet()
                                    .stream()  // Stream<Map<K,V>.Entry<<Long, List<DatasourceVO>>>
                                    .map(entry -> {
                                        HashMap<Long, DatasourceVO> resultMap = new HashMap<>();
                                        resultMap.put(entry.getKey(), entry.getValue().get(0));
                                        return resultMap;
                                    }) // Stream<HashMap<Long, DatasourceVO>> æ­¤æ—¶collectionä¼šè¿”å›List<Map>
                                    .flatMap(re -> re.entrySet().stream()) // Stream<Map<K,V>.Entry<Long, List<DatasourceVO>>
                                    .collect(Collectors.toMap(
                                            Map.Entry::getKey,
                                            Map.Entry::getValue));
					    
					    
}

```

- flatMap æµçš„æ‰å¹³åŒ–å¤„ç†è¿‡ç¨‹

![image-20210912184042320](img\FlatMapæ‰å¹³åŒ–æµè¿‡ç¨‹.png)

## 10. æ¢è¡Œå›è½¦ç¬¦ \r\n

å›è½¦ã€æ¢è¡Œçš„åŒºåˆ«

 åœ¨Windowsä¸­ï¼š

**â€˜\râ€™ (å›è½¦)ï¼šå³å°†å…‰æ ‡å›åˆ°å½“å‰è¡Œçš„è¡Œé¦–(è€Œä¸ä¼šæ¢åˆ°ä¸‹ä¸€è¡Œ)ï¼Œä¹‹åçš„è¾“å‡ºä¼šæŠŠä¹‹å‰çš„è¾“å‡ºè¦†ç›–**

â€˜\nâ€™ æ¢è¡Œï¼Œæ¢åˆ°å½“å‰ä½ç½®çš„ä¸‹ä¸€ä½ç½®ï¼Œè€Œä¸ä¼šå›åˆ°è¡Œé¦–ï¼›

Unixç³»ç»Ÿé‡Œï¼Œæ¯è¡Œç»“å°¾åªæœ‰â€œ<æ¢è¡Œ>â€ï¼Œ**å³"\n"ï¼›**

Windowsç³»ç»Ÿé‡Œé¢ï¼Œæ¯è¡Œç»“å°¾æ˜¯â€œ<å›è½¦><æ¢è¡Œ>â€ï¼Œ**å³â€œ\r\nâ€ï¼›**

Macç³»ç»Ÿé‡Œï¼Œæ¯è¡Œç»“å°¾æ˜¯â€œ<å›è½¦>â€ï¼Œ**å³"\r"ï¼›**

## 11.  java newä¸€ä¸ªå¯¹è±¡çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆ                       

javaåœ¨newä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œä¼šå…ˆæŸ¥çœ‹å¯¹è±¡æ‰€å±çš„ç±»æœ‰æ²¡æœ‰è¢«åŠ è½½åˆ°å†…å­˜ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œå°±ä¼šå…ˆé€šè¿‡ç±»çš„å…¨é™å®šåæ¥åŠ è½½ã€‚åŠ è½½å¹¶åˆå§‹åŒ–ç±»å®Œæˆåï¼Œå†è¿›è¡Œå¯¹è±¡çš„åˆ›å»ºå·¥ä½œã€‚

æˆ‘ä»¬å…ˆå‡è®¾æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨è¯¥ç±»ï¼Œè¿™æ ·çš„è¯newä¸€ä¸ªå¯¹è±¡å°±å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹ï¼š**åŠ è½½å¹¶åˆå§‹åŒ–ç±»**å’Œ**åˆ›å»ºå¯¹è±¡ã€‚**

> **ä¸€ã€ç±»åŠ è½½è¿‡ç¨‹ï¼ˆç¬¬ä¸€æ¬¡ä½¿ç”¨è¯¥ç±»ï¼‰**

ã€€ã€€javaæ˜¯ä½¿ç”¨**åŒäº²å§”æ´¾æ¨¡å‹**æ¥è¿›è¡Œç±»çš„åŠ è½½çš„ï¼Œæ‰€ä»¥åœ¨æè¿°ç±»åŠ è½½è¿‡ç¨‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å®ƒçš„å·¥ä½œè¿‡ç¨‹ï¼š

> **åŒäº²å§”æ‰˜æ¨¡å‹çš„å·¥ä½œè¿‡ç¨‹æ˜¯**ï¼šå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡çš„ç±»åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œå› æ­¤æ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œåªæœ‰å½“çˆ¶ç±»åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€è¦åŠ è½½çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ã€‚
> ä½¿ç”¨åŒäº²å§”æ‰˜æœºåˆ¶çš„å¥½å¤„æ˜¯ï¼šèƒ½å¤Ÿæœ‰æ•ˆç¡®ä¿ä¸€ä¸ªç±»çš„å…¨å±€å”¯ä¸€æ€§ï¼Œå½“ç¨‹åºä¸­å‡ºç°å¤šä¸ªé™å®šåç›¸åŒçš„ç±»æ—¶ï¼Œç±»åŠ è½½å™¨åœ¨æ‰§è¡ŒåŠ è½½æ—¶ï¼Œå§‹ç»ˆåªä¼šåŠ è½½å…¶ä¸­çš„æŸä¸€ä¸ªç±»ã€‚

- **1ã€åŠ è½½**

ã€€ã€€ã€€ã€€ ç”±ç±»åŠ è½½å™¨è´Ÿè´£æ ¹æ®ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è¯»å–æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµåˆ°JVMå†…éƒ¨ï¼Œå¹¶å­˜å‚¨åœ¨è¿è¡Œæ—¶å†…å­˜åŒºçš„æ–¹æ³•åŒºï¼Œç„¶åå°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªä¸ç›®æ ‡ç±»å‹å¯¹åº”çš„java.lang.Classå¯¹è±¡å®ä¾‹

- **2ã€éªŒè¯**

**æ ¼å¼éªŒè¯ï¼šéªŒè¯æ˜¯å¦ç¬¦åˆclassæ–‡ä»¶è§„èŒƒ** ï¼ˆå‰ç¼€ï¼‰
**è¯­ä¹‰éªŒè¯**ï¼šæ£€æŸ¥ä¸€ä¸ªè¢«æ ‡è®°ä¸ºfinalçš„ç±»å‹æ˜¯å¦åŒ…å«å­ç±»ï¼›æ£€æŸ¥ä¸€ä¸ªç±»ä¸­çš„finalæ–¹æ³•æ˜¯å¦è¢«å­ç±»è¿›è¡Œé‡å†™ï¼›ç¡®ä¿çˆ¶ç±»å’Œå­ç±»ä¹‹é—´æ²¡æœ‰ä¸å…¼å®¹çš„ä¸€äº›æ–¹æ³•å£°æ˜ï¼ˆæ¯”å¦‚æ–¹æ³•ç­¾åç›¸åŒï¼Œä½†æ–¹æ³•çš„è¿”å›å€¼ä¸åŒï¼‰
æ“ä½œéªŒè¯ï¼šåœ¨æ“ä½œæ•°æ ˆä¸­çš„æ•°æ®å¿…é¡»è¿›è¡Œæ­£ç¡®çš„æ“ä½œï¼Œå¯¹å¸¸é‡æ± ä¸­çš„å„ç§ç¬¦å·å¼•ç”¨æ‰§è¡ŒéªŒè¯ï¼ˆé€šå¸¸åœ¨è§£æé˜¶æ®µæ‰§è¡Œï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥é€šè¿‡ç¬¦å·å¼•ç”¨ä¸­æè¿°çš„å…¨é™å®šåå®šä½åˆ°æŒ‡å®šç±»å‹ä¸Šï¼Œä»¥åŠç±»æˆå‘˜ä¿¡æ¯çš„è®¿é—®ä¿®é¥°ç¬¦æ˜¯å¦å…è®¸è®¿é—®ç­‰ï¼‰

- **3ã€å‡†å¤‡**

ä¸ºç±»ä¸­çš„**æ‰€æœ‰é™æ€å˜é‡åˆ†é…å†…å­˜ç©ºé—´**ï¼Œå¹¶ä¸ºå…¶è®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ï¼ˆç”±äºè¿˜æ²¡æœ‰äº§ç”Ÿå¯¹è±¡ï¼Œå®ä¾‹å˜é‡ä¸åœ¨æ­¤æ“ä½œèŒƒå›´å†…ï¼‰
è¢«finalä¿®é¥°çš„staticå˜é‡ï¼ˆå¸¸é‡ï¼‰ï¼Œä¼šç›´æ¥èµ‹å€¼ï¼›

- **4ã€è§£æ**

å°†**å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨**ï¼ˆå¾—åˆ°ç±»æˆ–è€…å­—æ®µã€æ–¹æ³•åœ¨å†…å­˜ä¸­çš„æŒ‡é’ˆæˆ–è€…åç§»é‡ï¼Œä»¥ä¾¿ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•ï¼‰ï¼Œè¿™ä¸ªå¯ä»¥åœ¨åˆå§‹åŒ–ä¹‹åå†æ‰§è¡Œã€‚
è§£æéœ€è¦é™æ€ç»‘å®šçš„å†…å®¹ã€‚  // æ‰€æœ‰ä¸ä¼šè¢«é‡å†™çš„æ–¹æ³•å’ŒåŸŸéƒ½ä¼šè¢«é™æ€ç»‘å®š

ã€€ã€€**ä»¥ä¸Š2ã€3ã€4ä¸‰ä¸ªé˜¶æ®µåˆåˆç§°ä¸ºé“¾æ¥é˜¶æ®µ**ï¼Œé“¾æ¥é˜¶æ®µè¦åšçš„æ˜¯å°†åŠ è½½åˆ°JVMä¸­çš„äºŒè¿›åˆ¶å­—èŠ‚æµçš„ç±»æ•°æ®ä¿¡æ¯åˆå¹¶åˆ°JVMçš„è¿è¡Œæ—¶çŠ¶æ€ä¸­ã€‚

- **5ã€ç±»åˆå§‹åŒ–ï¼ˆå…ˆçˆ¶åå­ï¼‰**
  - 1 ä¸ºé™æ€å˜é‡èµ‹å€¼
  - 2 æ‰§è¡Œstaticä»£ç å—

> æ³¨æ„ï¼šstaticä»£ç å—åªæœ‰jvmèƒ½å¤Ÿè°ƒç”¨
> ã€€ã€€ã€€å¦‚æœæ˜¯å¤šçº¿ç¨‹éœ€è¦åŒæ—¶åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œä»…ä»…åªèƒ½å…è®¸å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹å¯¹å…¶æ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œå…¶ä½™çº¿ç¨‹å¿…é¡»ç­‰å¾…ï¼Œåªæœ‰åœ¨æ´»åŠ¨çº¿ç¨‹æ‰§è¡Œå®Œå¯¹ç±»çš„åˆå§‹åŒ–æ“ä½œä¹‹åï¼Œæ‰ä¼šé€šçŸ¥æ­£åœ¨ç­‰å¾…çš„å…¶ä»–çº¿ç¨‹ã€‚

 

å› ä¸ºå­ç±»å­˜åœ¨å¯¹çˆ¶ç±»çš„ä¾èµ–ï¼Œæ‰€ä»¥**ç±»çš„åŠ è½½é¡ºåºæ˜¯å…ˆåŠ è½½çˆ¶ç±»ååŠ è½½å­ç±»ï¼Œåˆå§‹åŒ–ä¹Ÿä¸€æ ·ã€‚**ä¸è¿‡ï¼Œçˆ¶ç±»åˆå§‹åŒ–æ—¶ï¼Œå­ç±»é™æ€å˜é‡çš„å€¼ä¹Ÿæœ‰æœ‰çš„ï¼Œæ˜¯é»˜è®¤å€¼ã€‚

æœ€ç»ˆï¼Œæ–¹æ³•åŒºä¼šå­˜å‚¨å½“å‰ç±»ç±»ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»çš„**é™æ€å˜é‡**ã€**ç±»åˆå§‹åŒ–ä»£ç **ï¼ˆ**å®šä¹‰é™æ€å˜é‡æ—¶çš„èµ‹å€¼è¯­å¥** å’Œ **é™æ€åˆå§‹åŒ–ä»£ç å—**ï¼‰ã€**å®ä¾‹å˜é‡å®šä¹‰**ã€**å®ä¾‹åˆå§‹åŒ–ä»£ç **ï¼ˆ**å®šä¹‰å®ä¾‹å˜é‡æ—¶çš„èµ‹å€¼è¯­å¥å®ä¾‹ä»£ç å—**å’Œ**æ„é€ æ–¹æ³•**ï¼‰å’Œ**å®ä¾‹æ–¹æ³•**ï¼Œè¿˜æœ‰**çˆ¶ç±»çš„ç±»ä¿¡æ¯å¼•ç”¨ã€‚**

 

>  **äºŒã€åˆ›å»ºå¯¹è±¡**

- **1ã€åœ¨å †åŒºåˆ†é…å¯¹è±¡éœ€è¦çš„å†…å­˜**

ã€€ã€€åˆ†é…çš„å†…å­˜åŒ…æ‹¬æœ¬ç±»å’Œçˆ¶ç±»çš„æ‰€æœ‰å®ä¾‹å˜é‡ï¼Œä½†ä¸åŒ…æ‹¬ä»»ä½•é™æ€å˜é‡

- **2ã€å¯¹æ‰€æœ‰å®ä¾‹å˜é‡èµ‹é»˜è®¤å€¼**

ã€€ã€€å°†æ–¹æ³•åŒºå†…å¯¹å®ä¾‹å˜é‡çš„å®šä¹‰æ‹·è´ä¸€ä»½åˆ°å †åŒºï¼Œç„¶åèµ‹é»˜è®¤å€¼

- **3ã€æ‰§è¡Œå®ä¾‹åˆå§‹åŒ–ä»£ç **

ã€€ã€€åˆå§‹åŒ–é¡ºåºæ˜¯å…ˆåˆå§‹åŒ–çˆ¶ç±»å†åˆå§‹åŒ–å­ç±»ï¼Œåˆå§‹åŒ–æ—¶å…ˆæ‰§è¡Œå®ä¾‹ä»£ç å—ç„¶åæ˜¯æ„é€ æ–¹æ³•

- **4ã€å¦‚æœæœ‰ç±»ä¼¼äºChild c = new Child()å½¢å¼çš„cå¼•ç”¨çš„è¯ï¼Œåœ¨æ ˆåŒºå®šä¹‰Childç±»å‹å¼•ç”¨å˜é‡cï¼Œç„¶åå°†å †åŒºå¯¹è±¡çš„åœ°å€èµ‹å€¼ç»™å®ƒ**

 

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ**æ¯ä¸ªå­ç±»å¯¹è±¡æŒæœ‰çˆ¶ç±»å¯¹è±¡çš„å¼•ç”¨**ï¼Œå¯åœ¨å†…éƒ¨é€šè¿‡superå…³é”®å­—æ¥è°ƒç”¨çˆ¶ç±»å¯¹è±¡ï¼Œä½†åœ¨å¤–éƒ¨ä¸å¯è®¿é—®

 

è¡¥å……ï¼š

é€šè¿‡å®ä¾‹å¼•ç”¨è°ƒç”¨å®ä¾‹æ–¹æ³•çš„æ—¶å€™ï¼Œå…ˆä»æ–¹æ³•åŒºä¸­å¯¹è±¡çš„å®é™…ç±»å‹ä¿¡æ¯æ‰¾ï¼Œæ‰¾ä¸åˆ°çš„è¯å†å»çˆ¶ç±»ç±»å‹ä¿¡æ¯ä¸­æ‰¾ã€‚

å¦‚æœç»§æ‰¿çš„å±‚æ¬¡æ¯”è¾ƒæ·±ï¼Œè¦è°ƒç”¨çš„æ–¹æ³•ä½äºæ¯”è¾ƒä¸Šå±‚çš„çˆ¶ç±»ï¼Œåˆ™è°ƒç”¨çš„æ•ˆç‡æ˜¯æ¯”è¾ƒä½çš„ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨éƒ½è¦ç»è¿‡å¾ˆå¤šæ¬¡æŸ¥æ‰¾ã€‚è¿™æ—¶å€™å¤§å¤šç³»ç»Ÿä¼šé‡‡ç”¨ä¸€ç§ç§°ä¸º**è™šæ–¹æ³•è¡¨**çš„æ–¹æ³•æ¥ä¼˜åŒ–è°ƒç”¨çš„æ•ˆç‡ã€‚

æ‰€è°“è™šæ–¹æ³•è¡¨ï¼Œå°±æ˜¯åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œä¸ºæ¯ä¸ªç±»åˆ›å»ºä¸€ä¸ªè¡¨ï¼Œè¿™ä¸ªè¡¨åŒ…æ‹¬è¯¥ç±»çš„å¯¹è±¡æ‰€æœ‰åŠ¨æ€ç»‘å®šçš„æ–¹æ³•åŠå…¶åœ°å€ï¼ŒåŒ…æ‹¬çˆ¶ç±»çš„æ–¹æ³•ï¼Œä½†ä¸€ä¸ªæ–¹æ³•åªæœ‰ä¸€æ¡è®°å½•ï¼Œå­ç±»é‡å†™äº†çˆ¶ç±»æ–¹æ³•ååªä¼šä¿ç•™å­ç±»çš„ã€‚å½“é€šè¿‡å¯¹è±¡åŠ¨æ€ç»‘å®šæ–¹æ³•çš„æ—¶å€™ï¼Œåªéœ€è¦æŸ¥æ‰¾è¿™ä¸ªè¡¨å°±å¯ä»¥äº†ï¼Œè€Œä¸éœ€è¦æŒ¨ä¸ªæŸ¥æ‰¾æ¯ä¸ªçˆ¶ç±»ã€‚

 

## 12. ThreadLocal

### 12.1 æºç 

```java
public class ThreadLocal<T> {
    // GetåŠ¨ä½œå®é™…æ˜¯å¾€å½“å‰çº¿ç¨‹çš„ThreadLocalMapå†…éƒ¨çš„Entryè¯»å–æ•°æ®
	public T get() {
        Thread t = Thread.currentThread();
        ThreadLocalMap map = getMap(t);
        if (map != null) {
            ThreadLocalMap.Entry e = map.getEntry(this);
            if (e != null) {
                @SuppressWarnings("unchecked")
                T result = (T)e.value;
                return result;
            }
        }
        return setInitialValue();
    }
    
    ThreadLocalMap getMap(Thread t) {
        // Threadçš„å±æ€§
        return t.threadLocals;
    }
    
    // SetåŠ¨ä½œå®é™…æ˜¯å¾€å½“å‰çº¿ç¨‹çš„ThreadLocalMapå†…éƒ¨çš„Entryå†™å…¥æ•°æ®
    public void set(T value) {
        Thread t = Thread.currentThread();
        ThreadLocalMap map = getMap(t);
        if (map != null)
            map.set(this, value);
        else
            // Threadä¸­çš„threadLocalsæ˜¯æ‡’åŠ è½½ï¼Œsetçš„æ—¶å€™æ‰åˆ›å»ºå¯¹è±¡
            createMap(t, value);
    }
    
    
    void createMap(Thread t, T firstValue) {
        // keyä¸ºå½“å‰ThreadLocal<T>å¯¹è±¡
        t.threadLocals = new ThreadLocalMap(this, firstValue);
    }
    
    // ğŸ”º removeåŠ¨ä½œå®é™…æ˜¯ThreadLocalMapæ‰§è¡Œäº†remove
    public void remove() {
         ThreadLocalMap m = getMap(Thread.currentThread());
         if (m != null)
             m.remove(this);
     }
    
    // é™æ€å†…éƒ¨ç±»
    static class ThreadLocalMap {
        
        private Entry[] table;
        
        // Entryç»§æ‰¿äº†å¼±å¼•ç”¨ï¼Œå¼±å¼•ç”¨æœ‰GCå°±ä¼šè¢«å›æ”¶
        static class Entry extends WeakReference<ThreadLocal<?>> {
            /** The value associated with this ThreadLocal. */
            Object value;

            Entry(ThreadLocal<?> k, Object v) {
                super(k);
                value = v;
            }
            
            // è¿™ä¸ªæ–¹æ³•æ˜¯çˆ¶ç±»çš„æ–¹æ³•ï¼Œremoveçš„æœ¬è´¨æ˜¯Entry.clear();
            public void clear() {
                // referentå³Entryæ„é€ æ–¹æ³•çš„k
                this.referent = null;
            }
            
        }
        
        private Entry getEntry(ThreadLocal<?> key) {
            int i = key.threadLocalHashCode & (table.length - 1);
            Entry e = table[i];
            if (e != null && e.get() == key)
                return e;
            else
                return getEntryAfterMiss(key, i, e);
        }
        
        private void remove(ThreadLocal<?> key) {
            Entry[] tab = table;
            int len = tab.length;
            int i = key.threadLocalHashCode & (len-1);
            for (Entry e = tab[i];
                 e != null;
                 e = tab[i = nextIndex(i, len)]) {
                if (e.get() == key) {
                    e.clear();
                    expungeStaleEntry(i);
                    return;
                }
            }
        }
    }
}
```

### 12.2 ThreadLocalçš„å†…å­˜æ³„éœ²

https://blog.csdn.net/puppylpg/article/details/80433271



